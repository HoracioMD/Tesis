{% extends 'basetemp.html' %}

			{% block titulo %}
			<title>Analisis estadistico</title>
			{% endblock %}

			{% block contenido %}
			<!-- start: Content -->
			<!-- start: Contenido -->
			<!-- start: Cuerpo -->
			<div id="content" class="span12">
			
			<ul class="breadcrumb">
				<li>
					<i class="icon-home"></i>
					<a href="{% url 'Principal' %}">Principal</a> 
					<i class="icon-angle-right"></i>
				</li>
				<li><a href="{% url 'AnalisisPredL96I' %}">Predicciones L96 I</a></li>
			</ul>
			
				<!-- start: Formulario -->
			<div class="row-fluid sortable">
			{% csrf_token %}
				<div class="row-fluid sortable">	
				<div class="box">
					<div class="box-header">
						<h2><i class="halflings-icon white align-justify"></i><span class="break"></span>Predicciones Lorenz'96 I almacenadas en el sistema</h2>
						<div class="box-icon">
							<a href="#" class="btn-minimize"><i class="halflings-icon white chevron-up"></i></a>
							<a href="#" class="btn-close"><i class="halflings-icon white remove"></i></a>
						</div>
					</div>
					<div class="box-content">
						<div id="Tablas">
              				<table id="TableL" class="table table-striped table-bordered display compact" cellspacing="0" width="100%">
              					<thead>
              						<tr>
              							<th>Nombre</th>         							
              							<th>Fecha</th>
              							<th>Dataset</th>
              							<th>Fn.Activación</th>
              							<th>Fn.Optimización</th>
              							<th>Fn.Perdida</th>
              							<!--th>MAE</th>
              							<th>MSE</th>
              							<th>RMSE</th>
              							<th>R2</th-->
              							<th>Acción</th>
              						</tr>
              					</thead>
              					<tbody>
              						{% for value in list_l96Ipred.items %}
              						<tr>
                                        <td class="nombre">{{ value.1.nombre }}</td>
                                        <td class="fecha">{{ value.1.fecha }}</td>
                                        <td class="dataset">{{ value.1.dataset }}</td>
                                        <td class="fact">{{ value.1.FAct }}</td>
                                        <td class="fopt">{{ value.1.FOpt }}</td>
                                        <td class="floss">{{ value.1.FLoss }}</td>
                                        <!--td class="mae">{{ value.1.MAE }}</td>
                                        <td class="mse">{{ value.1.MSE }}</td>
                                        <td class="rmse">{{ value.1.RMSE }}</td>
                                        <td class="r2">{{ value.1.R2 }}</td-->
                                        <td>
                                            <div class='btn-group' id="btns-action" data-filename="{{ value.0 }}">
                                              <button data-url="{% url 'graph_l96Ipred_dataset' %}" class="btn btn-primary" id="btnEjecutar" type="submit" data-loading-text="<i class='fa fa-spinner fa-spin'></i> Graficando">Graficar</button>
                                            </div>
                                        </td>
                                    </tr>
              						{% endfor %}           						
              					</tbody>
              				</table>          
						</div>
					</div>
				</div><!--/span-->
			    </div><!--/row-->
			<!-- end: Formulario -->

			<div class="row-fluid">
				<div class="box">
					<div class="box-header">
						<h2><i class="halflings-icon white list-alt"></i><span class="break"></span>Gráfica</h2>
						<div class="box-icon">
							<a href="#" class="btn-minimize"><i class="halflings-icon white chevron-up"></i></a>
							<a href="#" class="btn-close"><i class="halflings-icon white remove"></i></a>
						</div>
					</div>
					<!--grafica-->
					<div class="box-content">
						<!-- div id="sincos"  class="center" style="height:300px;" ></div-->
						<div id="graph" class="center" style="height:300px;" ></div>
						<p id="hoverdata">Puntos (<span id="x">0</span>, <span id="y">0</span>)</p>
					</div>
				</div>
			</div><!--/row-->

				       <!-- start: Formulario -->
			<div class="row-fluid sortable">
				<div class="box span6">
					<!-- Cabeza Formulario -->
					<div class="box-header" data-original-title>
						<h2><i class="halflings-icon white edit"></i><span class="break"></span>Métricas</h2>
						<div class="box-icon">
							<a href="#" class="btn-minimize"><i class="halflings-icon white chevron-up"></i></a>
							<a href="#" class="btn-close"><i class="halflings-icon white remove"></i></a>
						</div>
					</div>
					<!-- Fin Cabeza Formulario -->

					<!-- Contenido Formulario -->
					<div class="box-content">
						<form class="form-horizontal formulario" method="POST" action="#">
						{% csrf_token %}
							<fieldset>
							  <div class="control-group">
								<label class="form-check-label" for="exampleCheck1">Mean Absolute Error</label>
								<div class="controls">
									<input class="form-control" id="mae" type="text" placeholder="Valor" disabled>  				
								</div>
							  </div>
							  <div class="control-group">
								<label class="form-check-label" for="exampleCheck1">Mean Square Error</label>
								<div class="controls">
									<input class="form-control" id="mse" type="text" placeholder="Valor" disabled>
								</div>
							  </div>
							  <div class="control-group">
								<label class="form-check-label" for="exampleCheck1">Root Mean Square Error</label>
								<div class="controls">
									<input class="form-control" id="rmse" type="text" placeholder="Valor" disabled>  					
								</div>
							  </div>
							  <div class="control-group">
								<label class="form-check-label" for="exampleCheck1">R2 coefficent</label>
								<div class="controls">
									<input class="form-control" id="r2" type="text" placeholder="Valor" disabled> 
								</div>
							  </div>
							</fieldset>
						  </form>
					</div>
					<!-- Fin Contenido Formulario -->
				</div><!--/span-->

				<!-- start: Formulario -->
			<div class="row-fluid">	
				<div class="box span6">
					<div class="box-header">
						<h2><i class="halflings-icon white align-justify"></i><span class="break"></span>Tabla de resultados</h2>
						<div class="box-icon">
							<a href="#" class="btn-minimize"><i class="halflings-icon white chevron-up"></i></a>
							<a href="#" class="btn-close"><i class="halflings-icon white remove"></i></a>
						</div>
					</div>
					<div class="box-content">
						<div id="TablaLorenz">
              				<table id="TableL2" class ="display nowrap">
              					<thead>
              						<tr>
              							<th style="width:20%">Tiempo</th><th>Observación</th><th>Predicho</th>
              						</tr>
              					</thead>
              					<tbody>           						
              					</tbody>
              				</table>          
						</div> 
					</div>
				</div><!--/span-->
			</div><!--/#content.span10-->

		</div>

	    </div><!--/.fluid-container-->


		</div>

		{% endblock %}
	
		{% block js %}

		<script type="text/javascript">	


			$(document).ready(function() {

				$('#TableL2').dataTable({
    				"language": {
    			  			"emptyTable":  "  ",
    			  			"infoEmpty" : "Tabla de valores utilizados en el gráfico"
  				  		},
  					"searching": false,
  					"scrollY": 247,
                	"paging": false
    			});

    			$('#TableL').dataTable({
    
  					"searching": false,
  					"scrollY": 250,
                	"paging": false,
                	"info": false
    			});

				$('#TableL tbody').on('click', '#btnEjecutar', function(){
					var direccion = $(this).data('url')
					var filename = $(this).parents('div').data('filename')
					var token = '{{ csrf_token }}'

					$.ajax({
						headers: { "X-CSRFToken": token },
						url: direccion,
						type: 'POST',
						data: {'filename' : filename}}).done(function(data){
							//console.log(data)
							//Grafica
							var options = {
								series: {
									lines: {show: true },
									points: {show: false}
								},
              					grid: {
              						hoverable: {show: true}
              					},
              				};	
              				var plot = $.plot($("#graph"), [{label:"Predicho", data:data[0]},{label:"Observado", data:data[1]}],options)

              				//Cargando tabla
              				$.each(data[2], function (index, value) {
                  				var TableRow = "<tr>";
                  				$.each(value, function (key, val) {
                      				TableRow += "<td>" + val + "</td>";
                  				});
                  				TableRow += "</tr>";
                 				$('#TableL2').append(TableRow);
              				});

              				//Cargar las metricas
              				$("#mae").val(data[3])
              				$("#mse").val(data[4])
              				$("#rmse").val(data[5])
              				$("#r2").val(data[6])
						})			    
					})
				$("#graph").bind("plothover", function (event, pos, item) {
    			$("#x").text(pos.x.toFixed(2));
				$("#y").text(pos.y.toFixed(2)); });   
			})
  		</script>
		{% endblock %}